<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SUPERBET Odds Bar</title>

<style>
:root{
  --red:#E31B23;
  --redDark:#B31319;
  --white:#FFFFFF;
  --softWhite:rgba(255,255,255,.85);
}

*{ box-sizing:border-box; }

html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:transparent;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

.odds-bar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:60px;
  background: linear-gradient(90deg, var(--red), var(--redDark));
  display:flex;
  align-items:center;
}

.odds-inner{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  gap:60px;
  white-space:nowrap;
}

.brand img{
  height:140px;
  filter: brightness(0) invert(1);
}

.odds{
  display:flex;
  align-items:center;
  gap:50px;
}

.odd-item{
  display:flex;
  align-items:center;
  gap:14px;
  position:relative;
  padding-left:16px;
}

.odd-item::before{
  content:"";
  position:absolute;
  left:0;
  top:8px;
  bottom:8px;
  width:4px;
  background:var(--white);
  border-radius:2px;
}

.odd-value{
  font-size:22px;
  font-weight:900;
  color:var(--white);
  letter-spacing:.05em;
}

.odd-meta{
  display:flex;
  flex-direction:column;
  line-height:1.05;
}

.odd-team{
  font-size:15px;
  font-weight:800;
  color:var(--white);
}

.odd-label{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.18em;
  color:var(--softWhite);
}

.sep{
  width:1px;
  height:26px;
  background:rgba(255,255,255,.25);
}
</style>
</head>

<body>

<div
  class="odds-bar"
  data-endpoint-base="https://production-superbet-offer-br.freetls.fastly.net/v2/pt-BR/events/"
>
  <div class="odds-inner">

    <div class="brand">
      <img src="superbet-logo.svg" alt="SUPERBET">
    </div>

    <div class="odds">

      <div class="odd-item">
        <div class="odd-value" id="oddHome">â€”</div>
        <div class="odd-meta">
          <div class="odd-team" id="teamHome">â€”</div>
          <div class="odd-label">Casa</div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="odd-item">
        <div class="odd-value" id="oddDraw">â€”</div>
        <div class="odd-meta">
          <div class="odd-team">X</div>
          <div class="odd-label">Empate</div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="odd-item">
        <div class="odd-value" id="oddAway">â€”</div>
        <div class="odd-meta">
          <div class="odd-team" id="teamAway">â€”</div>
          <div class="odd-label">Fora</div>
        </div>
      </div>

    </div>

  </div>
</div>

<script>
(function(){
  const bar = document.querySelector(".odds-bar");
  const $ = (id) => document.getElementById(id);

  const elOddHome = $("oddHome");
  const elOddDraw = $("oddDraw");
  const elOddAway = $("oddAway");
  const elTeamHome = $("teamHome");
  const elTeamAway = $("teamAway");

  // ==========================
  // ðŸ”’ ID OBRIGATÃ“RIO VIA ?id=
  // ==========================

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    // NÃ£o preenche e nÃ£o roda nada
    console.warn("Overlay aguardando ?id=");
    return;
  }

  const cleanId = String(id).replace(/\D/g, "");
  if (!cleanId) return;

  bar.dataset.eventId = cleanId;

  function splitTeams(matchName){
    const s = String(matchName || "").trim();
    if (!s) return ["â€”","â€”"];
    if (s.includes("Â·")) return s.split("Â·").map(x => x.trim()).slice(0,2);
    if (s.includes(" x ")) return s.split(" x ").map(x => x.trim()).slice(0,2);
    if (s.includes(" vs ")) return s.split(" vs ").map(x => x.trim()).slice(0,2);
    return [s, "â€”"];
  }

  function extract1X2(item){
    const odds = Array.isArray(item?.odds) ? item.odds : [];

    const candidates = odds.filter(o => {
      const mn = String(o?.marketName || "").toLowerCase();
      return mn.includes("resultado final") || (mn.includes("resultado") && mn.includes("final"));
    });

    const pool = candidates.length ? candidates : odds;

    const groups = new Map();
    for (const o of pool) {
      const key = o?.marketUuid ?? o?.marketId;
      if (key == null) continue;
      if (!groups.has(key)) groups.set(key, []);
      groups.get(key).push(o);
    }

    let list = [];
    for (const g of groups.values()) {
      const names = g.map(x => String(x?.name ?? "").trim().toUpperCase());
      const codes = g.map(x => String(x?.code ?? "").trim().toUpperCase());

      const has1 = names.includes("1") || codes.includes("1");
      const has2 = names.includes("2") || codes.includes("2");
      const hasX = names.includes("X") || codes.includes("0") || codes.includes("X");

      if (has1 && has2 && hasX) { list = g; break; }
    }

    if (!list.length) return { "1": null, "X": null, "2": null };

    const out = { "1": null, "X": null, "2": null };

    for (const o of list) {
      const label = String(o?.name ?? "").trim().toUpperCase();
      const code  = String(o?.code ?? "").trim().toUpperCase();
      const price = Number(String(o?.price).replace(",", "."));
      if (!Number.isFinite(price)) continue;

      if (label === "1" || code === "1") out["1"] = price;
      else if (label === "2" || code === "2") out["2"] = price;
      else if (label === "X" || code === "0" || code === "X") out["X"] = price;
    }

    return out;
  }

  function formatOdd(v){
    return (typeof v === "number" && Number.isFinite(v)) ? v.toFixed(2) : "â€”";
  }

  async function update(){
    try{
      const base = bar.dataset.endpointBase;
      const eventId = bar.dataset.eventId;

      const url = base + encodeURIComponent(eventId);

      const res = await fetch(url, { cache: "no-store", headers: { "accept": "application/json" } });
      if (!res.ok) throw new Error("HTTP " + res.status);

      const json = await res.json();
      const item = json?.data?.[0];
      if (!item) return;

      const [home, away] = splitTeams(item.matchName);
      elTeamHome.textContent = (home || "â€”").toUpperCase();
      elTeamAway.textContent = (away || "â€”").toUpperCase();

      const phase = String(item?.metadata?.status || "").toUpperCase();
      const odds = extract1X2(item);

      if (phase === "FINISHED") return;

      elOddHome.textContent = formatOdd(odds["1"]);
      elOddDraw.textContent = formatOdd(odds["X"]);
      elOddAway.textContent = formatOdd(odds["2"]);

    } catch (err) {
      console.warn("[odds-bar] update failed:", err);
    }
  }

  update();
  setInterval(update, 1000);

})();
</script>

</body>
</html>
